DROP TABLE CLIENT CASCADE CONSTRAINTS PURGE;
DROP TABLE PRODUCT CASCADE CONSTRAINTS PURGE;
DROP TABLE CULTURE CASCADE CONSTRAINTS PURGE;
DROP TABLE CULTURETYPE CASCADE CONSTRAINTS PURGE;
DROP TABLE PRODUCTION CASCADE CONSTRAINTS PURGE;
DROP TABLE SALE CASCADE CONSTRAINTS PURGE;
DROP TABLE SECTOR CASCADE CONSTRAINTS PURGE;
DROP TABLE TIME CASCADE CONSTRAINTS PURGE;
DROP TABLE MONTH CASCADE CONSTRAINTS PURGE;
DROP TABLE YEAR CASCADE CONSTRAINTS PURGE;
DROP TABLE HUB CASCADE CONSTRAINTS PURGE;
DROP TABLE HUBNAME CASCADE CONSTRAINTS PURGE;
DROP TABLE HUBTYPE CASCADE CONSTRAINTS PURGE;


--SNOWFLAKE MODEL--
CREATE TABLE CLIENT
(
    id INTEGER generated by default as identity,
    fiscal_number INTEGER NOT NULL UNIQUE CHECK (fiscal_number>99999999 AND fiscal_number<1000000000),
    email VARCHAR(100) NOT NULL UNIQUE CHECK (email LIKE '%_@%__%.__%'),
    name VARCHAR(100) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE PRODUCT
(
    id INTEGER generated by default as identity,
    type      VARCHAR2(255) NOT NULL,
    name      VARCHAR2(255) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE CULTURE
(
    name VARCHAR2(255) NOT NULL PRIMARY KEY
);

CREATE TABLE CULTURETYPE
(
    type VARCHAR2(255) NOT NULL PRIMARY KEY
);

CREATE TABLE PRODUCTION
(
    id INTEGER generated by default as identity,
    time_id       INTEGER NOT NULL,
    sector_id     INTEGER NOT NULL,
    product_id    INTEGER NOT NULL,
    amount        INTEGER NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE SALE
(
    id         INTEGER generated by default as identity,
    time_id    INTEGER NOT NULL,
    client_id  INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    hub_id     INTEGER NOT NULL,
    quantity   INTEGER NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE SECTOR
(
    id          INTEGER generated by default as identity,
    name        VARCHAR(100) NOT NULL,
    exploration INTEGER NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE TIME
(
    id     INTEGER generated by default as identity,
    year   NUMBER(4, 0)  NOT NULL,
    month  NUMBER(2, 0)  NOT NULL CHECK (month BETWEEN 1 AND 12),
    PRIMARY KEY (id)
);

CREATE TABLE MONTH
(
    month NUMBER(2) NOT NULL CHECK (month BETWEEN 1 AND 12) PRIMARY KEY
);

CREATE TABLE YEAR
(
    year NUMBER(4) NOT NULL PRIMARY KEY
);

CREATE TABLE HUB
(
    id INTEGER generated by default as identity,
    hub_name VARCHAR(100) NOT NULL,
    hub_type VARCHAR(100) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE HUBNAME
(
    hub_name VARCHAR(100) NOT NULL PRIMARY KEY
);

CREATE TABLE HUBTYPE
(
    hub_type VARCHAR(100) NOT NULL PRIMARY KEY
);

ALTER TABLE PRODUCT
    ADD CONSTRAINT FKProductCultureId FOREIGN KEY (name) REFERENCES CULTURE (name);
ALTER TABLE PRODUCT
    ADD CONSTRAINT FKProductCultureTypeId FOREIGN KEY (type) REFERENCES CULTURETYPE (type);

ALTER TABLE PRODUCTION
    ADD CONSTRAINT FKProductionSectorId FOREIGN KEY (sector_id) REFERENCES SECTOR (id);
ALTER TABLE PRODUCTION
    ADD CONSTRAINT FKProductionProductId FOREIGN KEY (product_id) REFERENCES PRODUCT (id);
ALTER TABLE PRODUCTION
    ADD CONSTRAINT FKProductionTimeId FOREIGN KEY (time_id) REFERENCES TIME (id);

ALTER TABLE SALE
    ADD CONSTRAINT FKSaleClientId FOREIGN KEY (client_id) REFERENCES CLIENT (id);
ALTER TABLE SALE
    ADD CONSTRAINT FKSaleProductId FOREIGN KEY (product_id) REFERENCES PRODUCT (id);
ALTER TABLE SALE
    ADD CONSTRAINT FKSaleTimeId FOREIGN KEY (time_id) REFERENCES TIME (id);
ALTER TABLE SALE
    ADD CONSTRAINT FKSaleHubId FOREIGN KEY (hub_id) REFERENCES HUB (id);

ALTER TABLE TIME
    ADD CONSTRAINT FKTimeMonthId FOREIGN KEY (month) REFERENCES MONTH (month);
ALTER TABLE TIME
    ADD CONSTRAINT FKTimeYearId FOREIGN KEY (year) REFERENCES YEAR (year);

ALTER TABLE HUB
    ADD CONSTRAINT FKHubNameId FOREIGN KEY (hub_name) REFERENCES HUBNAME (hub_name);
ALTER TABLE HUB
    ADD CONSTRAINT FKHubTypeId FOREIGN KEY (hub_type) REFERENCES HUBTYPE (hub_type);


BEGIN
    FOR yearCounter IN 2017..2022
        LOOP
            INSERT INTO YEAR(YEAR) VALUES (yearCounter);
            FOR monthCounter IN 1..12
                LOOP
                    if (yearCounter = 2017) then
                        INSERT INTO MONTH(MONTH) VALUES (monthCounter);
                    end if;
                    INSERT INTO TIME(YEAR, MONTH) VALUES (yearCounter, monthCounter);
                end loop;
        end loop;
END;
/
INSERT INTO CULTURETYPE
VALUES ('Permanent');
INSERT INTO CULTURETYPE
VALUES ('Temporary');

INSERT INTO CULTURE
VALUES ('Apple');
INSERT INTO CULTURE
VALUES ('Pear');
INSERT INTO CULTURE
VALUES ('Banana');
INSERT INTO CULTURE
VALUES ('Pineapple');
INSERT INTO CULTURE
VALUES ('Tomato');
INSERT INTO CULTURE
VALUES ('Potato');
INSERT INTO CULTURE
VALUES ('Strawberry');
INSERT INTO CULTURE
VALUES ('Orange');

INSERT INTO PRODUCT(TYPE, NAME)
VALUES ('Permanent', 'Apple');
INSERT INTO PRODUCT(TYPE, NAME)
VALUES ('Permanent', 'Pear');
INSERT INTO PRODUCT(TYPE, NAME)
VALUES ('Permanent', 'Banana');
INSERT INTO PRODUCT(TYPE, NAME)
VALUES ('Permanent', 'Pineapple');
INSERT INTO PRODUCT(TYPE, NAME)
VALUES ('Temporary', 'Tomato');
INSERT INTO PRODUCT(TYPE, NAME)
VALUES ('Temporary', 'Potato');
INSERT INTO PRODUCT(TYPE, NAME)
VALUES ('Temporary', 'Strawberry');
INSERT INTO PRODUCT(TYPE, NAME)
VALUES ('Temporary', 'Orange');

INSERT INTO CLIENT(FISCAL_NUMBER, EMAIL, NAME)
VALUES (899435163, 'joao@gmail.com', 'Joao');
INSERT INTO CLIENT(FISCAL_NUMBER, EMAIL, NAME)
VALUES (324513239, 'diogo@gmail.com', 'Diogo');
INSERT INTO CLIENT(FISCAL_NUMBER, EMAIL, NAME)
VALUES (783127900, 'pedro@gmail.com', 'Pedro');

INSERT INTO SECTOR(name, exploration)
VALUES ('Tomato Field', 1);
INSERT INTO SECTOR(name, exploration)
VALUES ('Tomato Field', 2);
INSERT INTO SECTOR(name, exploration)
VALUES ('Orange Field', 1);
INSERT INTO SECTOR(name, exploration)
VALUES ('Orange Field', 2);
INSERT INTO SECTOR(name, exploration)
VALUES ('Potato Field', 1);
INSERT INTO SECTOR(name, exploration)
VALUES ('Potato Field', 2);
INSERT INTO SECTOR(name, exploration)
VALUES ('Strawberry Field', 1);
INSERT INTO SECTOR(name, exploration)
VALUES ('Strawberry Field', 2);
INSERT INTO SECTOR(name, exploration)
VALUES ('Apple Orchard', 1);
INSERT INTO SECTOR(name, exploration)
VALUES ('Apple Orchard', 2);
INSERT INTO SECTOR(name, exploration)
VALUES ('Pear Orchard', 1);
INSERT INTO SECTOR(name, exploration)
VALUES ('Pear Orchard', 2);
INSERT INTO SECTOR(name, exploration)
VALUES ('Banana Orchard', 1);
INSERT INTO SECTOR(name, exploration)
VALUES ('Banana Orchard', 2);
INSERT INTO SECTOR(name, exploration)
VALUES ('Pineapple Field', 1);
INSERT INTO SECTOR(name, exploration)
VALUES ('Pineapple Field', 2);

insert into HUBNAME
values ('Porto HUB');
insert into HUBNAME
values ('Lisboa HUB');
insert into HUBNAME
values ('Coimbra HUB');
insert into HUBNAME
values ('Braga HUB');
insert into HUBNAME
values ('Faro HUB');

insert into HUBTYPE
values ('C');
insert into HUBTYPE
values ('P');
insert into HUBTYPE
values ('E');


insert into HUB(hub_name, hub_type)
values ('Porto HUB', 'P');
insert into HUB(hub_name, hub_type)
values ('Lisboa HUB', 'E');
insert into HUB(hub_name, hub_type)
values ('Coimbra HUB', 'C');
insert into HUB(hub_name, hub_type)
values ('Braga HUB', 'P');
insert into HUB(hub_name, hub_type)
values ('Faro HUB', 'E');
insert into HUB(hub_name, hub_type)
values ('Aveiro HUB', 'C');


BEGIN
    FOR clientCounter IN 1..3
        LOOP
            FOR timeCounter IN 1..72
                LOOP
                    FOR productCounter IN 1..8
                        LOOP
                            FOR hubCounter IN 1..5
                            LOOP
                                INSERT INTO SALE(time_id, client_id, product_id, hub_id, quantity)
                                VALUES (timeCounter, clientCounter, productCounter, hubcounter, ROUND(DBMS_RANDOM.VALUE(1, 100000)));
                            end loop;
                        end loop;
                end loop;
        end loop;
    COMMIT;

    FOR sectorCounter IN 1..14
        LOOP
            FOR timeCounter IN 1..72
                LOOP
                    FOR productCounter IN 1..8
                        LOOP
                            INSERT INTO PRODUCTION(time_id, sector_id, product_id, amount)
                            VALUES (timeCounter, sectorCounter, productCounter, ROUND(DBMS_RANDOM.VALUE(1, 100000)));
                            COMMIT;
                        end loop;
                end loop;
        end loop;
END;